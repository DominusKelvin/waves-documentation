# О Waves Token Rating

**Waves Token Rating** — онлайн-сервис (https://tokenrating.wavesexplorer.com), показывающий рейтинги токенов (проектов), выпущенных на платформе Waves.

Рейтинги токенов формируются на основе мнений участников сообщества. В голосовании за токены могут принимать участие только держатели токенов WCT.

## Описание пользовательского интерфейса сервиса

Описание пользователького интерфейса сервиса с комментариями доступно на странице [Обзор пользовательского интерфейса Waves Token Rating](/waves-token-rating/waves-token-rating-user-interface-overview.md).

## Ограничения на голосование

Оценивать токены можно только из настольных версий браузеров. Для мобильных версий браузеров сервис доступен только на просмотр.

Процесс голосования за любой токен может быть инициирован любым пользователем при условии, что в его браузере установлен Waves Keeper, и на его балансе есть как минимум 1 WCT. Токены WCT не списываются при оценке (количество токенов на момент голосования влияет на вес оценки).

## Выставление оценки

Оценка может принимать целые значения от 1 до 5.

Чтобы выставить оценку токену, пользователь должен выбрать его в таблице рейтингов или через поисковую строку, затем на карточке токена указать количество звезд от 1 до 5, нажать кнопку **Оценить** и подписать [транзакцию](/waves-token-rating/user-score-data-transaction.md).

Если пользователь ранее уже голосовал за выбранный токен, то на карточке токена он увидит свою предыдущую оценку. В этом случае пользователь может изменить ее, проголосовав повторно. Предыдущая оценка будет аннулирована, а новая — учтена.

Если токен ещё никто не оценивал, то после выставления оценки он появится в таблице рейтингов, но без рейтинга, а со статусом "В обработке...", до того момента, пока оценка пользователя не будет рассчитана.

## Расчет веса оценки

### Формула расчёта веса оценки

При расчете рейтинга токена учитывается не только оценка пользователя, но также и вес этой оценки.

Вес оценки `W` рассчитывается по формуле:

```
W = B × k
```

где
`B` — эффективный баланс в токенах WCT,
`k` — весовой коэффициент.

Расчетное значение `W` округляется до целого числа.

### Расчет эффективного баланса `B`

В момент голосования записывается значение текущего баланса в WCT. В течении 24 часов проверяются все расходные операции в WCT по данному адресу и вычисляется их сумма `S`. По истечении 24-х часов из текущего баланса вычитается `S`. В результате получается эффективный баланс `B`.  

Если `B < 1`, то оценка не будет учитываться при расчете рейтинга токена.

### Расчет весового коэффициента `k`

Величина коэффициента `k` зависит от величины эффективного баланса `B` оценивающего и рассчитывается по формуле:

|Величина эффективного баланса `B` оценивающего|Значение коэффициента `k`|
|---|---|
|1 — 10|1|
|11 — 150,000|1.20958 – 0.091 × ln(`B`)|
|150,001 — 540,000|(– 0.00019 × `B` + 153) ÷ 1000|
|540,001 — ∞|0.05|

Полученное значение `k` округляется до сотых.

## Расчет рейтинга токена

Текущий рейтинг представляет собой мгновенное средневзвешенное значение оценок, выставленных пользователями. Пример расчета приводится ниже.

## Пример расчета рейтинга токена

**Пользователь 1** оценил токен в 5 баллов. На момент голосования на его счету было 10000 WCT.

За 24 часа на его счету было 3 операции: расход 300 WTC, расход 200 WTC и доход 500 WTC. Получается, расходные операции составляют 300 + 200 = 500 WTC. Таким образом 9500 WCT — это эффективный баланс `B` (несмотря на то что на счету через 24 часа остались те же 10000 WCT, что и на момент выставления оценки).

`B` находится в промежутке 11 — 150,000, значит рассчитываем `k` по формуле:
```
k = – 0,091 × ln(B) + 1,20958 = -0.091 × ln(9500) + 1.20958 = 0,38
```

Вес оценки:
```
W = B × k = 9500 × 0,38 = 3610
```

Итого: токен получит оценку 5 с весом 3610.



**Пользователь 2** оценил тот же токен в 4 балла. На момент голосования на его счету было 7 WCT.

За 24 часа расходных операций по счету не было, значит эффективный баланс равен 7 WCT.

`B` находится в промежутке 1 — 10, в этом случае:
```
k = 1
```

Вес оценки:
```
W = B × k = 7 × 1 = 7
```

Итого: токен получит оценку 4 с весом 7.

Финальный рейтинг `R` токена будет рассчитываться как средневзвешенное значение оценок, выставленных обоими пользователями:

```
R = (5 × 3610 + 4 × 7) / (3610 + 7) = 4.998 (округляется до 5.0)
```

Общее количество голосовавших токенов будет: за 5 — 3.6k, за 4 — 7.

<img src="img/token-rating.png" alt="faucet" width="300"/>


